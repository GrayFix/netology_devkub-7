# 12.3 Развертывание кластера на собственных серверах, лекция 1

Требования:
|Подсистема| CPU | RAM |Экземпляров|
|:-------- |:---:|:---:|:----:|
|База данных |1|4096|3|
|Кэш|1|4096|>=3|
|Фронтэнд|0.1|50|5|
|Бэкенд|1|500|10|
|**Итого**|**16.5**|**29826**|

Допущения:
- Все машины имеют одинаковую конфигурацию;
- При выводе ноды на обслуживание система должна работать без потери производительности. Нужна избыточность.

Предлагаемые решения:
1. Минимальная конфигурация 4 ноды: 8 ядер, 12 ГБ RAM. 
    1. Распределение в рабочем состоянии:
    
    |Нода|БД|КЭШ|Фронтэнд|Бэкенд|CPU|RAM|
    |-|-|-|-|-|-|-|
    |Сервер 1|1|1|1|2|4.1/8|9242/12288
    |Сервер 2|1|1|1|2|4.1/8|9242/12288
    |Сервер 3|1|1|1|2|4,1/8|9242/12288
    |Сервер 4|0|0|2|4|4.2/8|2100/12288

    2. Распределение в нерабочем состоянии (убрана одна из наиболее занятых машин):

    |Нода|БД|КЭШ|Фронтэнд|Бэкенд|CPU|RAM|
    |-|-|-|-|-|-|-|
    |Сервер 1|1|1|1|3|5,1/8|9742/12288
    |Сервер 2|1|1|1|3|5,1/8|9742/12288
    |~~Сервер 3~~|0|0|0|0|0/8|0/12288
    |Сервер 4|1|1|3|4|6,3/8|10342/12288

    3. Можно попробовать поискать сервер с 7 ядрами и 11 ГБ RAM, но не уверен что такие бывают. И под систему лучше оставить хотя-бы 500 МБ. 

2. Оптимальная конфигурация 6 нод: 6 ядер, 10 ГБ
    1. Распределение в рабочем состоянии:
    
    |Нода|БД|КЭШ|Фронтэнд|Бэкенд|CPU|RAM|
    |-|-|-|-|-|-|-|
    |Сервер 1|1|1|0|0|2/6|8192/10240
    |Сервер 2|1|1|0|0|2/6|8192/10240
    |Сервер 3|1|1|0|0|2/6|8192/10240
    |Сервер 4|0|1|2|3|4.2/6|5696/10240
    |Сервер 5|0|1|2|3|4.2/6|5696/10240
    |Сервер 6|0|1|1|4|5.1/6|6146/10240

    2. Распределение в нерабочем состоянии, без одного изх серверов БД:

    |Нода|БД|КЭШ|Фронтэнд|Бэкенд|CPU|RAM|
    |-|-|-|-|-|-|-|
    |Сервер 1|1|1|0|0|2/6|8192/10240
    |Сервер 2|1|1|0|0|2/6|8192/10240
    |~~Сервер 3~~|0|0|0|0|0/6|0/10240
    |Сервер 4|1|1|2|3|5.2/6|9792/10240
    |Сервер 5|0|2|2|3|5.2/6|9792/10240
    |Сервер 6|0|1|1|4|5.1/6|6146/10240
   
    3. Распределение в нерабочем состоянии, без сервера 6:

    |Нода|БД|КЭШ|Фронтэнд|Бэкенд|CPU|RAM|
    |-|-|-|-|-|-|-|
    |Сервер 1|1|1|0|2|4/6|9192/10240
    |Сервер 2|1|1|0|2|4/6|9192/10240
    |Сервер 3|1|1|0|0|2/6|8192/10240
    |Сервер 4|0|1|3|3|4.3/6|5746/10240
    |Сервер 5|0|2|2|3|5.2/6|9792/10240
    |~~Сервер 6~~|0|0|0|0|0/6|0/10240

    4. Т.к. серверов кэша 6 шт. можно, в случае аварии, один экземпляр вообще не поднимать. 
   
